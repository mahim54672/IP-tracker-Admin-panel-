<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel - IP Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: linear-gradient(135deg, #1e3c72, #2a5298);
      color: #333;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* ===== Login Page ===== */
    #loginPage {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    .login-box {
      background: #fff;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0,0,0,0.3);
      width: 100%;
      max-width: 360px;
      text-align: center;
      animation: fadeIn 1s ease;
    }
    .login-box h2 {
      margin-bottom: 20px;
      color: #2a5298;
      font-size: 22px;
    }
    .login-box input,
    .login-box button {
      width: 100%;
      padding: 12px;
      margin: 8px 0;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 15px;
      display: block;
    }
    .login-box button {
      background: #2a5298;
      color: #fff;
      border: none;
      cursor: pointer;
      transition: 0.3s;
    }
    .login-box button:hover { background: #1e3c72; }
    .error { color: red; font-size: 14px; margin-top: 10px; }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* ===== Admin Panel ===== */
    #adminPanel { display: none; padding: 15px; flex: 1; overflow-x: auto; }
    h1 { text-align: center; color: #fff; margin-bottom: 20px; font-size: 24px; }
    input[type="text"] {
      width: 100%; max-width: 400px; display: block; margin: 0 auto 15px auto;
      padding: 10px; border-radius: 5px; border: 1px solid #ccc; font-size: 15px;
    }
    .table-wrapper { overflow-x: auto; }
    table {
      width: 100%; border-collapse: collapse; background: #fff;
      box-shadow: 0 0 8px rgba(0,0,0,0.1); min-width: 800px;
    }
    th, td { border: 1px solid #ddd; padding: 8px; font-size: 14px; text-align: left; }
    th { background-color: #2a5298; color: white; }
    button { padding: 6px 10px; font-size: 12px; margin: 2px; border: none; border-radius: 3px; cursor: pointer; }
    .edit-btn { background-color: #ffc107; color: #000; }
    .delete-btn { background-color: #dc3545; color: #fff; }
    .save-btn { background-color: #28a745; color: #fff; }
    .cancel-btn { background-color: #6c757d; color: #fff; }

    /* ===== Responsive ===== */
    @media (max-width: 768px) {
      h1 { font-size: 20px; }
      .login-box { padding: 20px; }
      .login-box h2 { font-size: 20px; }
      .login-box input, .login-box button { font-size: 14px; padding: 10px; }
      table { font-size: 12px; }
      th, td { padding: 6px; }
    }
  </style>
</head>
<body>

  <!-- ===== Login Page ===== -->
  <div id="loginPage">
    <div class="login-box">
      <h2>üîê Admin Login</h2>
      <input type="text" id="email" placeholder="Email">
      <input type="password" id="password" placeholder="Password">
      <button onclick="login()">Login</button>
      <div class="error" id="errorMsg"></div>
    </div>
  </div>

  <!-- ===== Admin Panel ===== -->
  <div id="adminPanel">
    <h1>üìä Admin Panel - IP Tracker</h1>
    <input type="text" id="searchInput" placeholder="üîç Search IP, Country, City, etc...">
    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>IP</th>
            <th>Country</th>
            <th>Region</th>
            <th>City</th>
            <th>Postal</th>
            <th>ISP</th>
            <th>Lat</th>
            <th>Long</th>
            <th>Time</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="dataBody"></tbody>
      </table>
    </div>
  </div>

  <script>
    // ===== Login System =====
    async function login() {
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value.trim();
      const errorMsg = document.getElementById("errorMsg");

      try {
        const res = await fetch("https://raw.githubusercontent.com/mahim54672/Login-ip/refs/heads/main/config.json");
        const data = await res.json();
        const user = data.users.find(u => u.email === email && u.password === password);

        if (!user) { errorMsg.textContent = "‚ùå Invalid email or password!"; return; }
        if (user.status !== "active") { errorMsg.textContent = "üö´ Account is blocked!"; return; }

        const today = new Date();
        const expiry = new Date(user.expiry_date);
        if (today > expiry) { errorMsg.textContent = "‚è≥ Account expired!"; return; }

        // ‚úÖ Success
        document.getElementById("loginPage").style.display = "none";
        document.getElementById("adminPanel").style.display = "block";
        loadData();
      } catch (err) {
        errorMsg.textContent = "‚ö†Ô∏è Error loading config!";
        console.error(err);
      }
    }

    // ===== Firebase Config =====
    const firebaseConfig = {
      apiKey: "AIzaSyBuTzIg-rYAnnRK6o7WOyoh0ylY7-5CwLg",
      authDomain: "ip-track-abdb1.firebaseapp.com",
      databaseURL: "https://ip-track-abdb1-default-rtdb.firebaseio.com/",
      projectId: "ip-track-abdb1",
      storageBucket: "ip-track-abdb1.appspot.com",
      messagingSenderId: "311555011892",
      appId: "1:311555011892:web:935ae2cf458efdfd6de161"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // ===== Load Data =====
    function loadData() {
      db.ref("ipData").on("value", snapshot => {
        const data = snapshot.val();
        const tbody = document.getElementById("dataBody");
        tbody.innerHTML = "";
        if (!data) { tbody.innerHTML = `<tr><td colspan="10">No data available</td></tr>`; return; }
        for (let id in data) {
          const d = data[id];
          const row = document.createElement("tr");
          row.setAttribute("data-id", id);
          row.innerHTML = `
            <td contenteditable="false">${d.ip || ""}</td>
            <td contenteditable="false">${d.country || ""}</td>
            <td contenteditable="false">${d.region || ""}</td>
            <td contenteditable="false">${d.city || ""}</td>
            <td contenteditable="false">${d.postal || ""}</td>
            <td contenteditable="false">${d.org || ""}</td>
            <td contenteditable="false">${d.latitude || ""}</td>
            <td contenteditable="false">${d.longitude || ""}</td>
            <td contenteditable="false">${d.time || ""}</td>
            <td>
              <button class="edit-btn">Edit</button>
              <button class="delete-btn">Delete</button>
            </td>`;
          tbody.appendChild(row);
        }
      });
    }

    // ===== Search =====
    document.getElementById("searchInput").addEventListener("input", function () {
      const val = this.value.toLowerCase();
      document.querySelectorAll("#dataBody tr").forEach(row => {
        row.style.display = row.innerText.toLowerCase().includes(val) ? "" : "none";
      });
    });

    // ===== Edit/Delete =====
    document.getElementById("dataBody").addEventListener("click", function (e) {
      const row = e.target.closest("tr");
      const id = row.getAttribute("data-id");
      const tds = row.querySelectorAll("td");

      if (e.target.classList.contains("edit-btn")) {
        tds.forEach((td, i) => { if (i < 9) td.contentEditable = "true"; });
        e.target.textContent = "Save";
        e.target.className = "save-btn";
        const cancelBtn = document.createElement("button");
        cancelBtn.textContent = "Cancel";
        cancelBtn.className = "cancel-btn";
        e.target.parentNode.appendChild(cancelBtn);
      } else if (e.target.classList.contains("save-btn")) {
        const updated = {
          ip: tds[0].innerText,
          country: tds[1].innerText,
          region: tds[2].innerText,
          city: tds[3].innerText,
          postal: tds[4].innerText,
          org: tds[5].innerText,
          latitude: tds[6].innerText,
          longitude: tds[7].innerText,
          time: tds[8].innerText
        };
        db.ref("ipData/" + id).set(updated);
        tds.forEach((td, i) => { if (i < 9) td.contentEditable = "false"; });
        e.target.textContent = "Edit";
        e.target.className = "edit-btn";
        const cancelBtn = e.target.parentNode.querySelector(".cancel-btn");
        if (cancelBtn) cancelBtn.remove();
      } else if (e.target.classList.contains("cancel-btn")) {
        loadData();
      } else if (e.target.classList.contains("delete-btn")) {
        if (confirm("Delete this record?")) {
          db.ref("ipData/" + id).remove();
        }
      }
    });
  </script>
</body>
</html>